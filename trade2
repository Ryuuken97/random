-- Namecall hook untuk mendeteksi klik item
local mt = getrawmetatable(game)
local oldNamecall = mt.__namecall
setreadonly(mt, false)

mt.__namecall = newcclosure(function(self, ...)
	local args = { ... }
	local method = getnamecallmethod()

	if tostring(self) == "RE/EquipItem" and method == "FireServer" then
		-- Mode Save Items
		if TradeFunction.saveTempMode then
			local uuid, categoryName = args[1], args[2]
			if uuid and categoryName then
				table.insert(TradeFunction.TempTradeList, { UUID = uuid, Category = categoryName })
			end
			-- Blokir event EquipItem agar tidak equip item saat menyimpan
			return nil 

		-- Mode Trade Original (Single Item)
		elseif TradeFunction.onTrade then
			local uuid = args[1]
			local categoryName = args[2] -- Ambil kategori
			
			if uuid and TradeFunction.targetUserId and categoryName then
				-- Kirim trade
				InitiateTrade:InvokeServer(TradeFunction.targetUserId, uuid, categoryName)
				NotifySuccess("Trade Sent", "Trade sent to target.")
			else
				NotifyError("Trade Error", "Invalid target or item.")
			end
			-- Blokir event EquipItem agar tidak equip item saat mengirim trade
			return nil 
		end
		
		-- JIKA BUKAN TradeFunction.saveTempMode DAN BUKAN TradeFunction.onTrade, 
		-- maka lewati ke fungsi aslinya.
	end

	-- Panggil fungsi aslinya untuk semua kasus lain, termasuk EquipItem 
	-- yang tidak masuk ke kondisi TradeFunction.saveTempMode atau TradeFunction.onTrade.
	return oldNamecall(self, unpack(args))
end)

setreadonly(mt, true)
